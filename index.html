<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
  body {
    background: #040b15;
    background-image: url(xcom-enemy-unknown.jpg);
    background-repeat: space;
    padding: 0;
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    color: #00ff00;
    fill: #00ff00;
  }
  svg {
    width: 80%;
    max-height: 80%;
    border: 2px dashed #00ff00;
    background: #07070af0;
  }
  .line {
    fill: none;
    stroke: #00ff00;
    stroke-width: 2px;
  }
  #container {
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  </style>
  <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
  <div id="container"></div>

  <script>

const width = 800
const height = 600
const margin = ({top: 20, right: 30, bottom: 50, left: 50})
const parseTime = d3.timeParse("%d-%b-%y")

const data = d3.tsv("data.tsv", function(d) {
  d.date = parseTime(d.date);
  d.score = +d.score;
  return d;
}).then(data => {

  const line = d3.line()
      .defined(d => !isNaN(d.score))
      .x(d => x(d.date))
      .y(d => y(d.score))

      //.domain(d3.extent(data, d => d.date))
  const x = d3.scaleBand()
      .domain(data.map(x=>x.date))
      .range([margin.left, width - margin.right])

  const y = d3.scaleLinear()
      .domain([d3.min(data, d => d.score), d3.max(data, d => d.score)]).nice()
      .range([height - margin.bottom, margin.top])

  const xAxis = g => g
      .attr("transform", `translate(0,${height - margin.bottom})`)
      .call(d3.axisBottom(x).ticks(width / 80).tickSizeOuter(0))

  const yAxis = g => g
      .attr("transform", `translate(${margin.left},0)`)
      .call(d3.axisLeft(y))
      .call(g => g.select(".domain").remove())
      .call(g => g.select(".tick:last-of-type text").clone()
          .attr("x", 3)
          .attr("text-anchor", "start")
          .attr("font-weight", "bold")
          .text(data.y))

  const svg = d3.create("svg")
    .attr("viewBox", [0, 0, 800, 600]);

  svg.append("text")
      .attr("y", 10)
      .attr("x", 80)
      .attr("dy", "1em")
      .attr("font-size", "20px")
      .style("text-anchor", "left")
      .text("XCOM: Evolution Score Card");  

  svg.append("text")
      .attr("y", 570)
      .attr("x", (width / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Date");  

  svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 5)
      .attr("x", 0 - (height / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Score");    

  svg.append("g")
      .call(xAxis);

  svg.append("g")
      .call(yAxis);

  svg.append("line")
    .attr("x1", margin.left)
    .attr("x2", width - margin.right)
    .attr("y1", y(0))
    .attr("y2", y(0))
    .attr("stroke", "coral")

  svg.append("path")
      .datum(data)
      .attr("fill", "none")
      .attr("stroke", "#00b1ff")
      .attr("stroke-width", 1.5)
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("d", line)

  d3.select('#container').append(() => svg.node())
})

</script>
</body>
</html>