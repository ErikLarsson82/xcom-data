<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
  body {
    background: #040b15;
    background-image: url(xcom-enemy-unknown.jpg);
    background-repeat: space;
    padding: 0;
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    color: #00ff00;
    fill: #00ff00;
  }
  svg {
    width: 80%;
    max-height: 80%;
    border: 2px dashed #00ff00;
    background: #07070af0;
  }
  .line {
    fill: none;
    stroke: #00ff00;
    stroke-width: 2px;
  }
  #container {
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  </style>
  <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
  <div id="container"></div>

  <script>

const width = 800
const height = 600
const margin = ({top: 20, right: 0, bottom: 50, left: 50})

const parseTime = d3.timeParse("%d-%b-%y")
const formatTime = d3.timeFormat("%b %d")

const data = d3.tsv("data.tsv", function(d) {
  d.date = parseTime(d.date);
  d.score = +d.score;
  return d;
}).then(data => {

  const svg = d3.create("svg")
      .attr("viewBox", [0, 0, width, height]);

  const x = d3.scaleBand()
    .domain(d3.range(data.length))
    .range([margin.left, width - margin.right])
    .padding(0.1)
    
  const y = d3.scaleLinear()
    .domain([-100, 100])
    .range([height - margin.bottom, margin.top])

  const xAxis = g => g
    .attr("transform", `translate(0,${height - margin.bottom})`)
    .call(d3.axisBottom(x).tickFormat(i => `${formatTime(data[i].date)} ${data[i].group}`).ticks(data.length))

  const yAxis = g => g
      .attr("transform", `translate(${margin.left},0)`)
      .call(d3.axisLeft(y))
      .call(g => g.select(".domain").remove())
      .call(g => g.select(".tick:last-of-type text").clone()
          .attr("x", 3)
          .attr("text-anchor", "start")
          .attr("font-weight", "bold")
          .text(data.y))

  svg.append("g")
      .attr("fill", "steelblue")
    .selectAll("rect")
    .data(data)
    .join("rect")
      .attr("x", (d, i) => x(i))
      .attr("y", d => d.score > 0 ? y(d.score) : y(0))
      .attr("fill", d => d.score > 0 ? '#00ff00' : 'red')
      .attr("height", d => y(0) - y(Math.abs(d.score)))
      .attr("width", x.bandwidth());

  svg.append("g")
      .call(xAxis);

  svg.append("g")
      .call(yAxis);

svg.append("text")
      .attr("y", 10)
      .attr("x", 80)
      .attr("dy", "1em")
      .attr("font-size", "20px")
      .style("text-anchor", "left")
      .text("XCOM: Evolution Score Card");  

svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 5)
      .attr("x", 0 - (height / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Score");  

svg.append("text")
      .attr("y", 570)
      .attr("x", (width / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Date");  

  d3.select('#container').append(() => svg.node())
})

</script>
</body>
</html>